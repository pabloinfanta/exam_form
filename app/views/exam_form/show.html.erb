<div id="appointment" class="my-3">
	<div class="container bg-light border ">
		<%= image_tag('logo.png') %>
		<h2 class="text-center py-3">
			AGENDA TU HORA EMPRESA</h2>
		<div class="text-center mb-3">
			<span class="text-center text-danger">*</span><span> Los campos en rojo son necesarios para procesar la solicitud de hora.</span>
		</div>
		<%= form_with url:send_email_path, method: :post, html: { id: "appointment_form", class:"was-validated" }  do |form| %>
			<h5>Sucursal</h5>
			<div class="form-group">
				<%= form.label :Sucursal %><span class="text-danger">*</span>
				<%= form.text_field :city, id: 'appointment_city', class: 'form-control', placeholder: 'Ciudad o comuna donde se realizarán los exámenes',autofocus:true,  required: true %>
				<div class="invalid-feedback">Completa este campo</div>
				<div class="valid-feedback">Esta bien</div>
			</div>
			<h5 class= "mt-3">Datos Empresa</h5>
			<div class="row">
				<div class="col-md-6">
					<div class="row">
						<div class="col-md-12 form-group">
							<%= form.label :Empresa %><span class="text-danger">*</span>
							<%= form.text_field :company, required: true, id: 'appointment_company', class: 'form-control', placeholder: 'El nombre de la empresa que solicita los exámenes' %>
							<div class="invalid-feedback">Completa este campo</div>
							<div class="valid-feedback">Esta bien</div>
						</div>
						<div class="col-md-12 form-group">
							<%= form.label :Dirección %><span class="text-danger">*</span>
							<%= form.text_field :address, required: true, id: 'appointment_address', class: 'form-control', placeholder: 'Cual es la dirección de tu empresa' %>
							<div class="invalid-feedback">Completa este campo</div>
							<div class="valid-feedback">Esta bien</div>
						</div>
						<div class="col-md-12 form-group">
							<%= form.label :Rut %><span class="text-danger">*</span>
							<%= form.text_field :rut, required: true, id: 'appointment_rut', class: 'form-control', placeholder: 'Ingresa el RUT de tu empresa', pattern: '(\d{1,3}(?:\d{1,3}){2}-[\dkK])' %>
							<div class="invalid-feedback">Completa este campo, sin puntos y con guión</div>
							<div class="valid-feedback">Esta bien</div>
						</div>
						<div class="col-md-12 form-group">
							<%= form.label :Giro %><span class="text-danger">*</span>
							<%= form.text_field :giro, required: true, id: 'appointment_giro', class: 'form-control', placeholder: 'Ingresa la actividad económica de tu empresa' %>
							<div class="invalid-feedback">Completa este campo</div>
							<div class="valid-feedback">Esta bien</div>
						</div>
						<div class="col-md-12 form-group">
							<%= form.label :Centro_costos %><span class="text-danger">*</span>
							<%= form.text_field :cost_center, required: true, id: 'appointment_giro', class: 'form-control', placeholder: 'Ingresa la actividad económica de tu empresa' %>
							<div class="invalid-feedback">Completa este campo</div>
							<div class="valid-feedback">Esta bien</div>
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<div class="row">
						<div class="col-md-12 form-group">
							<%= form.label :Nombre_del_solicitante %><span class="text-danger">*</span>
							<%= form.text_field :applicant_name, required: true, id: 'appointment_name', class: 'form-control', placeholder: 'Cual es el nombre de la persona que solicita los exámenes' %>
							<div class="invalid-feedback">Completa este campo</div>
							<div class="valid-feedback">Esta bien</div>
						</div>
						<div class="col-md-12 form-group">
							<%= form.label :Teléfono_fijo %>
							<%= form.text_field :applicant_phone, id: 'appointment_phone', class: 'form-control', placeholder: 'Indícanos algún teléfono fijo en el que te podamos contactar' %>
							<div class="valid-feedback">No es necesario</div>
						</div>
						<div class="col-md-12 form-group">
							<%= form.label :Celular %><span class="text-danger">*</span>
							<%= form.text_field :applicant_cellphone, required: true, id: 'appointment_phone', class: 'form-control', placeholder: 'Indícanos algún móvil en el que te podamos contactar' %>
							<div class="invalid-feedback">Completa este campo</div>
							<div class="valid-feedback">Esta bien</div>
						</div>
						<div class="col-md-12 form-group">
							<%= form.label :Cargo %>
							<%= form.text_field :applicant_position, id: 'appointment_position', class: 'form-control', placeholder: 'El cargo que ocupas en tu empresa' %>
							<div class="valid-feedback">No es necesario</div>
						</div>
						<div class="col-md-12 form-group">
							<%= form.label :Email %><span class="text-danger">*</span>
							<%= form.email_field :applicant_email, required: true, id: 'appointment_email', class: 'form-control', placeholder: 'Indicanos una dirección de correo electrónico para poder comunicarnos contigo' %>
							<div class="invalid-feedback">Completa este campo en formato correo</div>
							<div class="valid-feedback">Esta bien</div>
						</div>
					</div>
				</div>
			</div>
			<hr>
			<h5>Ingreso de Trabajadores</h5>
			<em>Ingresa los datos de los trabajadores que se realizaran los exámenes, en caso de que se realizan el exámen en una fecha diferentes debes ingresarla en el espacio asignado. Puedes pinchar en botón con el signo mas para agregar mas de un trabajador a la vez.</em>
			<div class="float-right my-3">
				<i id="add" class="fas fa-user-plus fa-2x mx-auto text-right "></i>
				<i id="remove" class="fas fa-user-minus fa-2x mx-auto text-right"></i>
			</div>
			<div class="row my-4" id="workers">
				<div class="col-md-3 form-group" >
					<%= form.label :Nombre_completo %><span class="text-danger">*</span>
					<%= form.text_field :worker_name0, required: true, class: 'form-control' %>
					<div class="invalid-feedback">Completa este campo</div>
					<div class="valid-feedback">Esta bien</div>
				</div>
				<div class="col-md-2 form-group">
					<%= form.label :Edad %>
					<%= form.number_field :worker_age0, class: 'form-control' %>
					<div class="valid-feedback">No es necesario</div>
				</div>
				<div class="col-md-2 form-group">
					<%= form.label :Rut%><span class="text-danger">*</span>
					<%= form.text_field :worker_rut0, required: true, class: 'form-control', pattern: '(\d{1,3}(?:\d{1,3}){2}-[\dkK])' %>
					<div class="invalid-feedback">Sin puntos y con guión</div>
					<div class="valid-feedback">Esta bien</div>
				</div>
				<div class="col-md-3 form-group">
					<%= form.label :Cargo%><span class="text-danger">*</span>
					<%= form.text_field :worker_position0, required: true, class: 'form-control' %>
					<div class="invalid-feedback">Completa este campo</div>
					<div class="valid-feedback">Esta bien</div>
				</div>
				<div class="col-md-2 form-group ">
					<%= form.label :Comentario%>
					<%= form.text_field :worker_comment0, class: 'form-control' %>
					<div class="valid-feedback">No es necesario</div>
				</div>
			</div>
			<div class="form-group ">
				<h6>Fecha Requerida</h6>
				<em>Esta es la fecha en que todos los trabajadores o la mayoría del grupo se realizara los exámenes</em>
				<%= form.date_field :date_required, id: 'appointment_worker_date', class: 'form-control my-4' %>
				<div class="valid-feedback">No es necesario</div>
			</div>
			<hr>
			<h5>Batería de Exámenes a solicitar</h5>
			<%= form.check_box :exam_covid_19 %> <label><%= t(:covid_19) %></label><br>
			<%= form.check_box :exam_physical_height %> <label><%= t(:exam_physical_height) %></label><br>
			<%= form.check_box :exam_driver_vp %> <label><%= t(:exam_driver_vp) %></label><br>
			<%= form.check_box :exam_driver_vl %> <label><%= t(:exam_driver_vl) %></label><br>
			<%= form.check_box :exam_psycho_technical_vp %> <label><%= t(:exam_psycho_technical_vp) %></label><br>
			<%= form.check_box :exam_psycho_technical_vl %> <label><%= t(:exam_psycho_technical_vp) %></label><br>
			<%= form.check_box :exam_risk_condition %> <label><%= t(:exam_risk_condition) %></label><br>
			<%= form.check_box :exam_cold_exposure %> <label><%= t(:exam_cold_exposure) %></label><br>
			<%= form.check_box :exam_heat_exposure %> <label><%= t(:exam_heat_exposure) %></label><br>
			<%= form.check_box :exam_confined_spaces %> <label><%= t(:exam_confined_spaces) %></label><br>
			<%= form.check_box :exam_visual_ability %> <label><%= t(:exam_visual_ability) %></label><br>
			<%= form.check_box :exam_hearing %> <label><%= t(:exam_hearing) %></label><br>
			<%= form.check_box :exam_geographic_height %> <label><%= t(:exam_geographic_height)%></label><br>
			<%= form.check_box :exam_noise %> <label><%= t(:exam_noise)%></label><br>
			<%= form.check_box :exam_rescue_brigade %> <label><%= t(:exam_rescue_brigade)%></label><br>
			<h6 class="mt-4">Otros exámenes</h6>
			<em>¿Necesitas un exámen que no esta en nuestra lista? por favor escribelo en este campo</em>
			<div class="form-group my-3">
				<%= form.text_field :exam_extra, id: 'body_batery', class: 'form-control' %>
				<div class="valid-feedback">No es necesario</div>
			</div>
			<hr>
			<h5>Drogas</h5>
			<%= form.check_box :drug_alcohol %> <label><%= t(:drug_alcohol) %></label> <br>
			<%= form.check_box :drug_marijuana %> <label><%= t(:drug_marijuana) %></label> <br>
			<%= form.check_box :drug_cocaine %> <label><%= t(:drug_cocaine) %></label> <br>
			<h6 class="mt-4">Otros exámenes de drogas</h6>
			<em>¿Necesitas un exámen de drogas que no esta en nuestra lista? por favor escribelo en este campo</em>
			<div class="form-group my-3">
				<%= form.text_field :drug_extra, id: 'body_drug', class: 'form-control' %>
				<div class="valid-feedback">No es necesario</div>
			</div>
			<hr>
			<div class="text-center">
				<h5>Los resultados estarán disponibles en la página: <a href="https://www.gesalud.cl" target= "_blank">www.gesalud.cl</a></h5>
			</div>
			<div class="text-center">
				<%= form.submit 'ENVIAR SOLICITUD AHORA', data: { disable_with: "Enviando..." } , class: 'btn btn-primary btn-lg my-3' %>
			</div>
		<% end %>
	</div>
</div>
<script>
	var id = 1
	$("#add").click(function() {
		var div1 = document.createElement("div");
		div1.setAttribute("class", "col-md-3 form-group mt-2");

		var div2 = document.createElement("div");
		div2.setAttribute("class", "col-md-2 form-group  mt-2");

		var div3 = document.createElement("div");
		div3.setAttribute("class", "col-md-2 form-group  mt-2");

		var div4 = document.createElement("div");
		div4.setAttribute("class", "col-md-3 form-group  mt-2");

		var div5 = document.createElement("div");
		div5.setAttribute("class", "col-md-2 form-group  mt-2");

		var span01 = document.createElement("span");
		span01.appendChild(document.createTextNode("*"));
		span01.setAttribute("class", "text-danger");

		var span02 = document.createElement("span");
		span02.appendChild(document.createTextNode("*"));
		span02.setAttribute("class", "text-danger");

		var span03 = document.createElement("span");
		span03.appendChild(document.createTextNode("*"));
		span03.setAttribute("class", "text-danger");

		var label_name = document.createElement("label");
		label_name.appendChild(document.createTextNode("Nombre completo"));

		var input_name = document.createElement("INPUT");
		input_name.setAttribute("type", "text");
		input_name.setAttribute("class", "form-control");
		input_name.setAttribute("required", "required");
		input_name.setAttribute("name", "worker_name" + id);

		var label_age = document.createElement("label");
		label_age.appendChild(document.createTextNode("Edad"));

		var input_age = document.createElement("INPUT");
		input_age.setAttribute("type", "number");
		input_age.setAttribute("class", "form-control");
		input_age.setAttribute("name", "worker_age" + id);

		var label_rut = document.createElement("label");
		label_rut.appendChild(document.createTextNode("Rut"));

		var input_rut = document.createElement("INPUT");
		input_rut.setAttribute("type", "text");
		input_rut.setAttribute("class", "form-control");
		input_rut.setAttribute("required", "required");
		input_rut.setAttribute("pattern", "(\\d{1,3}(?:\\d{1,3}){2}-[\\dkK])");
		input_rut.setAttribute("name", "worker_rut" + id);

		var label_position = document.createElement("label");
		label_position.appendChild(document.createTextNode("Cargo"));

		var input_position = document.createElement("INPUT");
		input_position.setAttribute("type", "text");
		input_position.setAttribute("class", "form-control");
		input_position.setAttribute("required", "required");
		input_position.setAttribute("name", "worker_position" + id);

		var label_comment = document.createElement("label");
		label_comment.appendChild(document.createTextNode("Comentario"));

		var input_comment = document.createElement("INPUT");
		input_comment.setAttribute("type", "text");
		input_comment.setAttribute("class", "form-control");
		input_comment.setAttribute("name", "worker_comment" + id);

		var valid1 = document.createElement("div");
		valid1.setAttribute("class", "valid-feedback");
		valid1.appendChild(document.createTextNode("Esta bien"));

		var invalid1 = document.createElement("div");
		invalid1.setAttribute("class", "invalid-feedback");
		invalid1.appendChild(document.createTextNode("Completa este campo"));

		var valid2 = document.createElement("div");
		valid2.setAttribute("class", "valid-feedback");
		valid2.appendChild(document.createTextNode("No es necesario"));

		var valid3 = document.createElement("div");
		valid3.setAttribute("class", "valid-feedback");
		valid3.appendChild(document.createTextNode("Esta bien"));

		var invalid3 = document.createElement("div");
		invalid3.setAttribute("class", "invalid-feedback");
		invalid3.appendChild(document.createTextNode("Sin puntos y con guión"));

		var valid4 = document.createElement("div");
		valid4.setAttribute("class", "valid-feedback");
		valid4.appendChild(document.createTextNode("Esta bien"));

		var invalid4 = document.createElement("div");
		invalid4.setAttribute("class", "invalid-feedback");
		invalid4.appendChild(document.createTextNode("Completa este campo"));

		var valid5 = document.createElement("div");
		valid5.setAttribute("class", "valid-feedback");
		valid5.appendChild(document.createTextNode("No es necesario"));

		div1.appendChild(label_name);
		div1.appendChild(span01);
		div1.appendChild(input_name);
		div1.appendChild(valid1);
		div1.appendChild(invalid1);

		div2.appendChild(label_age);
		div2.appendChild(input_age);
		div2.appendChild(valid2);

		div3.appendChild(label_rut);
		div3.appendChild(span02);
		div3.appendChild(input_rut);
		div3.appendChild(valid3);
		div3.appendChild(invalid3);

		div4.appendChild(label_position);
		div4.appendChild(span03);
		div4.appendChild(input_position);
		div4.appendChild(valid4);
		div4.appendChild(invalid4);

		div5.appendChild(label_comment);
		div5.appendChild(input_comment);
		div5.appendChild(valid5);

		$('#workers').append(div1);
		$('#workers').append(div2);
		$('#workers').append(div3);
		$('#workers').append(div4);
		$('#workers').append(div5);
		id = id + 1
	});
	
		$("#remove").click(function() {
		$('#workers > .form-group').slice(-5).remove();
		id = id - 1
	});

	(function () {
		'use strict'

		var forms = document.querySelectorAll('.needs-validation')

		Array.prototype.slice.call(forms)
				.forEach(function (form) {
				form.addEventListener('submit', function (event) {
						if (!form.checkValidity()) {
						event.preventDefault()
						event.stopPropagation()

						}
						document.querySelectorAll("input.form-control:invalid");

						form.classList.add('was-validated')
				}, false)
				})
})()
</script>
